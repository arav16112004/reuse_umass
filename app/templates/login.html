{% extends "base.html" %}

{% block content %}
<div style="max-width: 400px; margin: 4rem auto;">
     <div class="card" style="padding: 2rem;">
          <h1>Login</h1>
          <p class="subtitle">Access your ReUse UMass account</p>

          <form id="login-form">
               <div id="error-message"
                    style="display: none; background: #fee; color: #c00; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem;">
               </div>

               <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="username" required placeholder="your.email@umass.edu">
               </div>

               <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
               </div>

               <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
          </form>

          <p style="text-align: center; margin-top: 1.5rem; color: var(--text-muted);">
               Don't have an account? <a href="/signup" style="color: var(--primary-green);">Sign up</a>
          </p>
     </div>
</div>

<script>
     document.getElementById('login-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);

          try {
               const response = await fetch('/api/v1/auth/token', {
                    method: 'POST',
                    body: formData
               });

               if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('access_token', data.access_token);
                    window.location.href = '/';
               } else {
                    document.getElementById('error-message').style.display = 'block';
                    document.getElementById('error-message').textContent = 'Invalid email or password';
               }
          } catch (error) {
               document.getElementById('error-message').style.display = 'block';
               document.getElementById('error-message').textContent = 'Login failed. Please try again.';
          }
     });
</script>
{% endblock %}