{% extends "base.html" %}

{% block content %}
<div style="max-width: 400px; margin: 4rem auto;">
     <div class="card" style="padding: 2rem;">
          <h1>Sign Up</h1>
          <p class="subtitle">Join ReUse UMass</p>

          <form id="signup-form">
               <div id="error-message"
                    style="display: none; background: #fee; color: #c00; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem;">
               </div>
               <div id="success-message"
                    style="display: none; background: #efe; color: #070; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem;">
               </div>

               <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="full_name" placeholder="John Doe">
               </div>

               <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required placeholder="your.email@umass.edu">
               </div>

               <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required minlength="6">
               </div>

               <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
          </form>

          <p style="text-align: center; margin-top: 1.5rem; color: var(--text-muted);">
               Already have an account? <a href="/login" style="color: var(--primary-green);">Login</a>
          </p>
     </div>
</div>

<script>
     document.getElementById('signup-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const data = {
               email: formData.get('email'),
               password: formData.get('password'),
               full_name: formData.get('full_name')
          };

          try {
               const response = await fetch('/api/v1/auth/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
               });

               if (response.ok) {
                    document.getElementById('success-message').style.display = 'block';
                    document.getElementById('success-message').textContent = 'Account created! Redirecting to login...';
                    setTimeout(() => window.location.href = '/login', 2000);
               } else {
                    const error = await response.json();
                    document.getElementById('error-message').style.display = 'block';
                    document.getElementById('error-message').textContent = error.detail || 'Signup failed';
               }
          } catch (error) {
               document.getElementById('error-message').style.display = 'block';
               document.getElementById('error-message').textContent = 'Signup failed. Please try again.';
          }
     });
</script>
{% endblock %}